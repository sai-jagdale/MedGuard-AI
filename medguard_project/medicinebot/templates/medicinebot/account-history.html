{% extends 'medicinebot/base.html' %}
{% load static %}
{% load tz %} {# Load timezone tags #}

{% block title %}Search History - MedGuard AI{% endblock %}

{% block content %}
<div class="flex flex-wrap justify-between gap-4 w-full">
    <h1 class="text-text-light dark:text-text-dark text-4xl font-black leading-tight tracking-[-0.033em]">Search History</h1>
</div>
<div class="flex flex-col gap-6 w-full max-w-4xl">
    
    {% for item in history_list %}
    <!-- History Item Card -->
    <div class="flex items-stretch justify-between gap-6 rounded-xl bg-content-light dark:bg-content-dark p-6 shadow-lg border border-border-light dark:border-border-dark overflow-hidden">
        
        {# --- FIX: Added min-w-0 to force text wrapping within flexbox --- #}
        <div class="flex flex-col gap-4 {% if item.image_data_url %}w-full md:w-2/3{% else %}w-full{% endif %} min-w-0">
            <div class="flex flex-col gap-1">
                <p class="text-subtle-light dark:text-subtle-dark text-sm font-normal leading-normal">
                    Searched on: {{ item.timestamp|localtime|date:"M. j, Y, P" }}
                </p>
                <p class="text-text-light dark:text-text-dark text-base font-bold leading-tight">Analysis Summary</p>
            </div>
            <div class="text-subtle-light dark:text-subtle-dark text-sm font-normal leading-normal break-words whitespace-pre-wrap">
                {{ item.analysis_summary|safe }}
            </div>
        </div>
        
        {% if item.image_data_url %}
        <div class="w-full md:w-1/3 flex-shrink-0 hidden sm:block">
            <div class="w-full bg-center bg-no-repeat aspect-square bg-cover rounded-lg border border-border-light dark:border-border-dark" 
                 style="background-image: url('{{ item.image_data_url }}');">
            </div>
        </div>
        {% endif %}
    </div>
    <!-- End History Item Card -->
    {% endfor %}

    {% if not history_list %}
    <!-- No History State -->
    <div class="flex flex-col items-center justify-center gap-4 rounded-lg border border-dashed border-border-light dark:border-border-dark bg-content-light/50 dark:bg-content-dark/50 p-8 text-center">
        <div class="flex items-center justify-center size-12 rounded-full bg-gray-200 dark:bg-gray-800 text-subtle-light dark:text-subtle-dark">
            <span class="material-symbols-outlined text-3xl">history</span>
        </div>
        <p class="text-lg font-bold text-text-light dark:text-text-dark">No history yet</p>
        <p class="text-sm text-subtle-light dark:text-subtle-dark max-w-sm">Your search history is empty. Your future analyses will appear at the top of this list.</p>
        <div class="mt-4">
            <a href="{% url 'home' %}" class="flex min-w-[84px] max-w-[480px] cursor-pointer items-center justify-center overflow-hidden rounded-lg h-12 px-6 bg-primary text-white text-sm font-bold leading-normal tracking-[0.015em]">
                <span class="truncate">Start New Search</span>
            </a>
        </div>
    </div>
    {% endif %}

</div>
{% endblock %}

